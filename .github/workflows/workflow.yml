name: Flask Server

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2 

      - name: Install pip Dependencies
        uses: actions/setup-python@v4
        with:
         python-version: '3.10'
         cache: 'pip'

      - run: |
            pip install -r requirements.txt

     

      - name: Set up ngrok
        run: sudo snap install ngrok --devmode && ngrok config add-authtoken ${{ secrets.NGROK_TOKEN }}

      - name: forward port to web
        run: ngrok http --domain=key-grizzly-directly.ngrok-free.app 5000 &

      - name: Starting application
        run: | 
            sudo service mysql start && python app.py \
            'rnojb-152-58-77-52.a.free.pinggy.link' \
            '41753' \
            'root' \
            'password' \
            'mydb' \
             

      - run: sleep 600      

  






       
